<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Supabase ì´ë¯¸ì§€ ì—…ë¡œë“œ & ë‹¤ìš´ë¡œë“œ & ì‚­ì œ</title>

</head>
<body>
<h2>Supabase ì´ë¯¸ì§€ ì—…ë¡œë“œ & ë‹¤ìš´ë¡œë“œ & ì‚­ì œ</h2>

<!-- íŒŒì¼ ì—…ë¡œë“œ -->
<input type="file" id="fileInput">
<button onclick="uploadImage()">ì—…ë¡œë“œ</button>

<h3>ğŸ“¸ ì—…ë¡œë“œëœ ì´ë¯¸ì§€ ëª©ë¡</h3>
<div id="imageList"></div>
</body>
</html>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
  // Supabase ì„¤ì •
  const supabaseUrl = "https://fnlkxffpqrffrlovnmys.supabase.co";
  const supabasePassword = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZubGt4ZmZwcXJmZnJsb3ZubXlzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Mzk0MjQ5NzYsImV4cCI6MjA1NTAwMDk3Nn0.1Ova5eln8PKRQJaXi9kqUQdTzWzq5cpKRkxd9bykvsw";
  const supabase = window.supabase.createClient(supabaseUrl, supabasePassword);
  const bucketName = "ex01"; // ì €ì¥ì†Œ ë²„í‚· ì´ë¦„

  // âœ… 1. ì´ë¯¸ì§€ ì—…ë¡œë“œ
  async function uploadImage() {
    const fileInput = document.getElementById("fileInput");
    const file = fileInput.files[0];

    if (!file) {
      alert("íŒŒì¼ì„ ì„ íƒí•˜ì„¸ìš”!");
      return;
    }

    const fileName = `${crypto.randomUUID()}.${file.name.split('.').pop()}`; // íŒŒì¼ëª… ì¤‘ë³µ ë°©ì§€
    console.log(fileName);

    // Supabase Storage ì—…ë¡œë“œ
    const { data, error } = await supabase.storage
            .from(bucketName)
            .upload(fileName, file);

    if (error) {
      alert("ì—…ë¡œë“œ ì‹¤íŒ¨: " + error.message);
      return;
    }

    alert("âœ… ì—…ë¡œë“œ ì„±ê³µ!");
    fileInput.value = ""; // íŒŒì¼ ì„ íƒ ì´ˆê¸°í™”
    loadImages(); // ì´ë¯¸ì§€ ëª©ë¡ ìƒˆë¡œê³ ì¹¨
  }

  // âœ… 2. ì´ë¯¸ì§€ ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸°
  async function loadImages() {
    const { data, error } = await supabase.storage
            .from(bucketName)
            .list();

    if (error) {
      console.error("ì´ë¯¸ì§€ ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨:", error.message);
      return;
    }

    const imageList = document.getElementById("imageList");
    imageList.innerHTML = ""; // ê¸°ì¡´ ëª©ë¡ ì´ˆê¸°í™”

    data.forEach(file => {
      const fileUrl = supabase.storage.from(bucketName).getPublicUrl(file.name).data.publicUrl;

      // ì´ë¯¸ì§€ ëª©ë¡ UI ì¶”ê°€
      const listItem = document.createElement("div");
      listItem.innerHTML = `
                <p>${file.name}</p>
                <a href="${fileUrl}" target="_blank">
                    <img src="${fileUrl}" width="150" alt="${file.name}">
                </a>
                <br>
                <button onclick="deleteImage('${file.name}')">ì‚­ì œ</button>
            `;
      imageList.appendChild(listItem);
    });
  }

  // âœ… 3. ì´ë¯¸ì§€ ì‚­ì œ
  async function deleteImage(fileName) {
    const { error } = await supabase.storage
            .from(bucketName)
            .remove([fileName]);

    if (error) {
      alert("ì‚­ì œ ì‹¤íŒ¨: " + error.message);
      return;
    }

    alert("ğŸ—‘ï¸ ì‚­ì œ ì„±ê³µ!");
    loadImages(); // ëª©ë¡ ìƒˆë¡œê³ ì¹¨
  }

  // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ë¯¸ì§€ ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸°
  window.onload = loadImages;

  // ì‚­ì œ í•¨ìˆ˜ ì „ì—­ ë“±ë¡ (HTML ë²„íŠ¼ì—ì„œ ì‚¬ìš© ê°€ëŠ¥í•˜ë„ë¡)
  window.deleteImage = deleteImage;
</script>


<!--

ì—…ë¡œë“œ í•  ë•Œ



-->